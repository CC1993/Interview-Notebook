# 消息中间件

消息中间件也可称作消息系统 (MQ)，它本质上是一个暂存转发消息的一个中间件。在分布式应用当中，我们可以把一个业务操作转换成一个消息，比如支付宝的余额转入余额宝操作，支付宝系统执行减少余额操作之后向消息系统发送一个消息，余额宝系统订阅这条消息然后进行增加余额宝操作。

# 消息队列

![](index_files/96b63e13-e2d8-4ddb-9aa1-a38959ca96e5.jpg)

# 发布/订阅

![](index_files/654acfed-a6a5-4fc7-8f40-3fdcae57bae8.jpg)

# 发送端的可靠性

发送端完成操作后一定能将消息成功发送到消息系统。

实现方法：

*   在本地数据库建一张消息表，将消息数据与业务数据保存在同一数据库实例里，这样就可以利用本地数据库的事务机制。事务提交成功后，将消息表中的消息转移到消息中间件，若转移消息成功则删除消息表中的数据，否则继续重传。

# 接收端的可靠性

接收端能够从消息中间件成功消费一次消息。

实现方法：

*   保证接收端处理消息的业务逻辑具有幂等性：只要具有幂等性，那么消费多少次消息，最后处理的结果都是一样的。
*   保证消息具有唯一编号，并使用一张日志表来记录已经消费的消息编号。